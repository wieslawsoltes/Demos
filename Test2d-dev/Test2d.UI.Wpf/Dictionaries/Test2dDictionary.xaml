<!-- Copyright (c) Wiesław Šoltés. All rights reserved. -->
<!-- Licensed under the MIT license. See LICENSE file in the project root for full license information. -->
<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:sys="clr-namespace:System;assembly=mscorlib"
    xmlns:core="clr-namespace:Test2d;assembly=Test2d"
    xmlns:converters="clr-namespace:Test.Converters"
    xmlns:controls="clr-namespace:Test.Controls"
    xmlns:p="clr-namespace:Test2d.UI.Wpf.Properties">
    <!-- converters -->
    <converters:ArgbColorToBrushConverter x:Key="ArgbColorToBrushConverter"/>
    <converters:ArgbColorToBrushMultiConverter x:Key="ArgbColorToBrushMultiConverter"/>
    <converters:BooleanToStringConverter x:Key="BooleanToStarConverter" FalseValue="" TrueValue="*"/>
    <converters:DoubleToStringConverter x:Key="DoubleToStringConverter"/>
    <converters:EnumToBooleanConverter x:Key="EnumToBooleanConverter"/>
    <converters:FlagsEnumConverter x:Key="FontStyleFlagsEnumConverter"/>
    <converters:FlagsEnumConverter x:Key="StateFlagsEnumConverter"/>
    <converters:FlagsEnumConverter x:Key="MagLengthFlagsEnumConverter"/>
    <converters:FlagsEnumConverter x:Key="StartStateFlagsEnumConverter"/>
    <converters:FlagsEnumConverter x:Key="EndStateFlagsEnumConverter"/>
    <converters:ObjectEqualityConverter x:Key="ObjectEqualityConverter"/>
    <converters:ColumnParameterConverter x:Key="ColumnParameterConverter"/>
    <converters:RecordParameterConverter x:Key="RecordParameterConverter"/>
    <converters:ValueParameterConverter x:Key="ValueParameterConverter"/>
    <converters:ShapeBindingParameterConverter x:Key="ShapeBindingParameterConverter"/>
    <converters:ShapePropertyParameterConverter x:Key="ShapePropertyParameterConverter"/>
    <!-- enums -->
    <ObjectDataProvider x:Key="MoveModeValues" MethodName="GetValues" ObjectType="{x:Type sys:Enum}">
        <ObjectDataProvider.MethodParameters>
            <x:Type TypeName="core:MoveMode"/>
        </ObjectDataProvider.MethodParameters>
    </ObjectDataProvider>
    <ObjectDataProvider x:Key="TextHAlignmentValues" MethodName="GetValues" ObjectType="{x:Type sys:Enum}">
        <ObjectDataProvider.MethodParameters>
            <x:Type TypeName="core:TextHAlignment"/>
        </ObjectDataProvider.MethodParameters>
    </ObjectDataProvider>
    <ObjectDataProvider x:Key="TextVAlignmentValues" MethodName="GetValues" ObjectType="{x:Type sys:Enum}">
        <ObjectDataProvider.MethodParameters>
            <x:Type TypeName="core:TextVAlignment"/>
        </ObjectDataProvider.MethodParameters>
    </ObjectDataProvider>
    <ObjectDataProvider x:Key="ArrowTypeValues" MethodName="GetValues" ObjectType="{x:Type sys:Enum}">
        <ObjectDataProvider.MethodParameters>
            <x:Type TypeName="core:ArrowType"/>
        </ObjectDataProvider.MethodParameters>
    </ObjectDataProvider>
    <ObjectDataProvider x:Key="LineCapValues" MethodName="GetValues" ObjectType="{x:Type sys:Enum}">
        <ObjectDataProvider.MethodParameters>
            <x:Type TypeName="core:LineCap"/>
        </ObjectDataProvider.MethodParameters>
    </ObjectDataProvider>
    <ObjectDataProvider x:Key="XSweepDirectionValues" MethodName="GetValues" ObjectType="{x:Type sys:Enum}">
        <ObjectDataProvider.MethodParameters>
            <x:Type TypeName="core:XSweepDirection"/>
        </ObjectDataProvider.MethodParameters>
    </ObjectDataProvider>
    <ObjectDataProvider x:Key="XFillRuleValues" MethodName="GetValues" ObjectType="{x:Type sys:Enum}">
        <ObjectDataProvider.MethodParameters>
            <x:Type TypeName="core:XFillRule"/>
        </ObjectDataProvider.MethodParameters>
    </ObjectDataProvider>
    <!-- brushes -->
    <SolidColorBrush x:Key="BackgroundColor" Color="White" />
    <SolidColorBrush x:Key="DarkSquareColor" Color="DarkGray" />
    <SolidColorBrush x:Key="LightSquareColor" Color="LightGray" />
    <DrawingBrush x:Key="CheckerBoard" Viewport="0,0,20,20" ViewportUnits="Absolute" Stretch="None" TileMode="Tile">
        <DrawingBrush.Drawing>
            <DrawingGroup>
                <GeometryDrawing Brush="{DynamicResource DarkSquareColor}">
                    <GeometryDrawing.Geometry>
                        <GeometryGroup>
                            <RectangleGeometry Rect="0,0,10,10"/>
                            <RectangleGeometry Rect="10,10,10,10"/>
                        </GeometryGroup>
                    </GeometryDrawing.Geometry>
                </GeometryDrawing>
                <GeometryDrawing Brush="{DynamicResource LightSquareColor}">
                    <GeometryDrawing.Geometry>
                        <GeometryGroup>
                            <RectangleGeometry Rect="10,0,10,10"/>
                            <RectangleGeometry Rect="0,10,10,10"/>
                        </GeometryGroup>
                    </GeometryDrawing.Geometry>
                </GeometryDrawing>
            </DrawingGroup>
        </DrawingBrush.Drawing>
    </DrawingBrush>
    <!-- styles -->
    <Style x:Key="TextBlockLeftStyleKey" TargetType="TextBlock">
        <Setter Property="Margin" Value="5,2,5,2"/>
        <Setter Property="TextAlignment" Value="Left"/>
        <Setter Property="VerticalAlignment" Value="Center"/>
    </Style>
    <Style x:Key="TextBoxLeftStyleKey" TargetType="TextBox">
        <Setter Property="BorderBrush" Value="{x:Null}"/>
        <Setter Property="Margin" Value="5,2,5,2"/>
        <Setter Property="TextAlignment" Value="Left"/>
        <Setter Property="VerticalAlignment" Value="Center"/>
    </Style>
    <Style x:Key="TextBlockCenterStyleKey" TargetType="TextBlock">
        <Setter Property="Margin" Value="5,2,5,2"/>
        <Setter Property="TextAlignment" Value="Center"/>
        <Setter Property="VerticalAlignment" Value="Center"/>
    </Style>
    <Style x:Key="TextBoxCenterStyleKey" TargetType="TextBox">
        <Setter Property="BorderBrush" Value="{x:Null}"/>
        <Setter Property="Margin" Value="5,2,5,2"/>
        <Setter Property="TextAlignment" Value="Center"/>
        <Setter Property="VerticalAlignment" Value="Center"/>
    </Style>
    <Style x:Key="CheckBoxStyleKey" TargetType="CheckBox">
        <Setter Property="Margin" Value="5,2,5,2"/>
    </Style>
    <Style x:Key="ComboBoxStyleKey" TargetType="ComboBox">
        <Setter Property="Margin" Value="5,2,5,2"/>
    </Style>
    <Style x:Key="SliderStyleKey" TargetType="Slider">
        <Setter Property="Margin" Value="5,2,5,2"/>
    </Style>
    <!-- common -->
    <ControlTemplate x:Key="NameControlTemplateKey">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="60"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <TextBlock 
                Text="Name" 
                Style="{StaticResource TextBlockLeftStyleKey}"
                Grid.Row="0" 
                Grid.Column="0">
            </TextBlock>
            <TextBox 
                Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" 
                BorderBrush="{x:Null}" 
                Style="{StaticResource TextBoxLeftStyleKey}" 
                Grid.Row="0" 
                Grid.Column="1">
            </TextBox>
        </Grid>
    </ControlTemplate>
    <ControlTemplate x:Key="IsStrokedControlTemplateKey">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="60"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <TextBlock 
                Text="IsStroked" 
                Style="{StaticResource TextBlockLeftStyleKey}"
                Grid.Row="0"
                Grid.Column="0">
            </TextBlock>
            <CheckBox 
                Content=""
                IsChecked="{Binding IsStroked}"
                Style="{StaticResource CheckBoxStyleKey}"
                Grid.Row="0" 
                Grid.Column="1">
            </CheckBox>
        </Grid>
    </ControlTemplate>
    <ControlTemplate x:Key="IsFilledControlTemplateKey">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="60"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <TextBlock 
                Text="IsFilled" 
                Style="{StaticResource TextBlockLeftStyleKey}"
                Grid.Row="0"
                Grid.Column="0">
            </TextBlock>
            <CheckBox 
                Content=""
                IsChecked="{Binding IsFilled}"
                Style="{StaticResource CheckBoxStyleKey}"
                Grid.Row="0" 
                Grid.Column="1">
            </CheckBox>
        </Grid>
    </ControlTemplate>
    <ControlTemplate x:Key="IsSmoothJoinControlTemplateKey">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="60"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <TextBlock 
                Text="IsSmoothJoin" 
                Style="{StaticResource TextBlockLeftStyleKey}"
                Grid.Row="0"
                Grid.Column="0">
            </TextBlock>
            <CheckBox 
                Content=""
                IsChecked="{Binding IsSmoothJoin}"
                Style="{StaticResource CheckBoxStyleKey}"
                Grid.Row="0" 
                Grid.Column="1">
            </CheckBox>
        </Grid>
    </ControlTemplate>
    <ControlTemplate x:Key="IsClosedControlTemplateKey">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="60"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <TextBlock 
                Text="IsClosed" 
                Style="{StaticResource TextBlockLeftStyleKey}"
                Grid.Row="0"
                Grid.Column="0">
            </TextBlock>
            <CheckBox 
                Content=""
                IsChecked="{Binding IsClosed}"
                Style="{StaticResource CheckBoxStyleKey}"
                Grid.Row="0" 
                Grid.Column="1">
            </CheckBox>
        </Grid>
    </ControlTemplate>
    <!-- path -->
    <DataTemplate DataType="{x:Type core:XPathSize}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="90"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="40"/>
            </Grid.ColumnDefinitions>
            <TextBlock 
                Text="Width" 
                Style="{StaticResource TextBlockLeftStyleKey}"
                Grid.Row="0" 
                Grid.Column="0" >
            </TextBlock>
            <TextBlock 
                Text="Height" 
                Style="{StaticResource TextBlockLeftStyleKey}"
                Grid.Row="1" 
                Grid.Column="0" >
            </TextBlock>
            <TextBox 
                Text="{Binding Width, UpdateSourceTrigger=PropertyChanged}" 
                Style="{StaticResource TextBoxLeftStyleKey}"
                Grid.Row="0" 
                Grid.Column="1" 
                Grid.ColumnSpan="2">
            </TextBox>
            <TextBox 
                Text="{Binding Height, UpdateSourceTrigger=PropertyChanged}" 
                Style="{StaticResource TextBoxLeftStyleKey}"
                Grid.Row="1" 
                Grid.Column="1" 
                Grid.ColumnSpan="2">
            </TextBox>
        </Grid>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XArcSegment}">
        <StackPanel>
            <Control Template="{StaticResource IsStrokedControlTemplateKey}"/>
            <Control Template="{StaticResource IsSmoothJoinControlTemplateKey}"/>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="90"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="40"/>
                </Grid.ColumnDefinitions>
                <TextBlock 
                    Text="RotationAngle" 
                    Style="{StaticResource TextBlockLeftStyleKey}"
                    Grid.Row="0"
                    Grid.Column="0">
                </TextBlock>
                <TextBlock 
                    Text="IsLargeArc" 
                    Style="{StaticResource TextBlockLeftStyleKey}"
                    Grid.Row="1"
                    Grid.Column="0">
                </TextBlock>
                <TextBlock 
                    Text="SweepDirection" 
                    Style="{StaticResource TextBlockLeftStyleKey}" 
                    Grid.Row="2" 
                    Grid.Column="0">
                </TextBlock>
                <TextBox 
                    Text="{Binding RotationAngle, UpdateSourceTrigger=PropertyChanged}" 
                    Style="{StaticResource TextBoxLeftStyleKey}"
                    Grid.Row="0" 
                    Grid.Column="1" 
                    Grid.ColumnSpan="2">
                </TextBox>
                <CheckBox 
                    Content=""
                    IsChecked="{Binding IsLargeArc}"
                    Style="{StaticResource CheckBoxStyleKey}"
                    Grid.Row="1" 
                    Grid.Column="1" 
                    Grid.ColumnSpan="2">
                </CheckBox>
                <ComboBox 
                    ItemsSource="{Binding Source={StaticResource ResourceKey=XSweepDirectionValues}}" 
                    SelectedItem="{Binding SweepDirection}" 
                    Style="{StaticResource ComboBoxStyleKey}"
                    Grid.Row="2" 
                    Grid.Column="1" 
                    Grid.ColumnSpan="2">
                </ComboBox>
            </Grid>
            <Expander Header="Point">
                <ContentControl Content="{Binding Point}"/>
            </Expander>
            <Expander Header="Size">
                <ContentControl Content="{Binding Size}"/>
            </Expander>
        </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XBezierSegment}">
        <StackPanel>
            <Control Template="{StaticResource IsStrokedControlTemplateKey}"/>
            <Control Template="{StaticResource IsSmoothJoinControlTemplateKey}"/>
            <Expander Header="Point1">
                <ContentControl Content="{Binding Point1}"/>
            </Expander>
            <Expander Header="Point2">
                <ContentControl Content="{Binding Point2}"/>
            </Expander>
            <Expander Header="Point3">
                <ContentControl Content="{Binding Point3}"/>
            </Expander>
        </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XLineSegment}">
        <StackPanel>
            <Control Template="{StaticResource IsStrokedControlTemplateKey}"/>
            <Control Template="{StaticResource IsSmoothJoinControlTemplateKey}"/>
            <Expander Header="Point">
                <ContentControl Content="{Binding Point}"/>
            </Expander>
        </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XPolyBezierSegment}">
        <StackPanel>
            <Control Template="{StaticResource IsStrokedControlTemplateKey}"/>
            <Control Template="{StaticResource IsSmoothJoinControlTemplateKey}"/>
            <Expander Header="Points">
                <ListBox
                    ItemsSource="{Binding Points}"
                    BorderBrush="{x:Null}"
                    BorderThickness="0"
                    HorizontalContentAlignment="Stretch"
                    Height="140">
                </ListBox>
            </Expander>
        </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XPolyLineSegment}">
        <StackPanel>
            <Control Template="{StaticResource IsStrokedControlTemplateKey}"/>
            <Control Template="{StaticResource IsSmoothJoinControlTemplateKey}"/>
            <Expander Header="Points">
                <ListBox
                    ItemsSource="{Binding Points}"
                    BorderBrush="{x:Null}"
                    HorizontalContentAlignment="Stretch"
                    Height="140">
                </ListBox>
            </Expander>
        </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XPolyQuadraticBezierSegment}">
        <StackPanel>
            <Control Template="{StaticResource IsStrokedControlTemplateKey}"/>
            <Control Template="{StaticResource IsSmoothJoinControlTemplateKey}"/>
            <Expander Header="Points">
                <ListBox
                    ItemsSource="{Binding Points}"
                    BorderBrush="{x:Null}"
                    HorizontalContentAlignment="Stretch"
                    Height="140">
                </ListBox>
            </Expander>
        </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XQuadraticBezierSegment}">
        <StackPanel>
            <Control Template="{StaticResource IsStrokedControlTemplateKey}"/>
            <Control Template="{StaticResource IsSmoothJoinControlTemplateKey}"/>
            <Expander Header="Point1">
                <ContentControl Content="{Binding Point1}"/>
            </Expander>
            <Expander Header="Point2">
                <ContentControl Content="{Binding Point2}"/>
            </Expander>
        </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XPathFigure}">
        <StackPanel>
            <Control Template="{StaticResource IsFilledControlTemplateKey}"/>
            <Control Template="{StaticResource IsClosedControlTemplateKey}"/>
            <Expander Header="StartPoint">
                <ContentControl Content="{Binding StartPoint}"/>
            </Expander>
        </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XPathGeometry}">
        <StackPanel>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="90"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="40"/>
                </Grid.ColumnDefinitions>
                <TextBlock 
                    Text="FillRule" 
                    Style="{StaticResource TextBlockLeftStyleKey}"
                    Grid.Row="0"
                    Grid.Column="0">
                </TextBlock>
                <ComboBox 
                    ItemsSource="{Binding Source={StaticResource ResourceKey=XFillRuleValues}}" 
                    SelectedItem="{Binding FillRule}" 
                    Style="{StaticResource ComboBoxStyleKey}"          
                    Grid.Row="0" 
                    Grid.Column="1" 
                    Grid.ColumnSpan="2">
                </ComboBox>
            </Grid>
            <TabControl>
                <TabItem Header="Figures">
                    <TreeView 
                        x:Name="tree" 
                        ItemsSource="{Binding Figures}"
                        Margin="5,2,5,2">
                        <TreeView.ItemContainerStyle>
                            <Style TargetType="TreeViewItem">
                                <Setter Property="IsExpanded" Value="True"/>
                            </Style>
                        </TreeView.ItemContainerStyle>
                        <TreeView.ItemTemplate>
                            <HierarchicalDataTemplate ItemsSource="{Binding Segments}">
                                <HierarchicalDataTemplate.ItemContainerStyle>
                                    <Style TargetType="TreeViewItem">
                                        <Setter Property="IsExpanded" Value="True"/>
                                    </Style>
                                </HierarchicalDataTemplate.ItemContainerStyle>
                                <HierarchicalDataTemplate.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding}"/>
                                    </DataTemplate>
                                </HierarchicalDataTemplate.ItemTemplate>
                                <TextBlock Text="{Binding}"/>
                            </HierarchicalDataTemplate>
                        </TreeView.ItemTemplate>
                    </TreeView>
                </TabItem>
                <TabItem Header="Selected">
                    <ContentControl 
                        Content="{Binding}"                
                        DataContext="{Binding ElementName=tree, Path=SelectedItem}"
                        Margin="5,5,5,5"
                        Grid.Column="2">
                    </ContentControl>
                </TabItem>
            </TabControl>
        </StackPanel>
    </DataTemplate>
    <!-- shape -->
    <ControlTemplate x:Key="StyleControlTemplateKey">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="60"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <TextBlock 
                Text="Style" 
                Style="{StaticResource TextBlockLeftStyleKey}"
                Grid.Row="0" 
                Grid.Column="0">
            </TextBlock>
            <ComboBox 
                ItemsSource="{Binding Path=DataContext.Editor.Project.CurrentStyleLibrary.Styles, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}" 
                SelectedItem="{Binding Path=DataContext.Style, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type StackPanel}}}"
                Style="{StaticResource ComboBoxStyleKey}"
                Grid.Row="0" 
                Grid.Column="1">
                <ComboBox.ItemTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}"/>
                    </DataTemplate>
                </ComboBox.ItemTemplate>
            </ComboBox>
        </Grid>
    </ControlTemplate>
    <ControlTemplate x:Key="StateControlTemplateKey">
        <StackPanel Margin="5,2,5,2">
            <CheckBox Content="Default" Margin="1"
                      IsChecked="{Binding Path=State, Converter={StaticResource StateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Default}}">
            </CheckBox>
            <CheckBox Content="Visible" Margin="1"
                      IsChecked="{Binding Path=State, Converter={StaticResource StateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Visible}}">
            </CheckBox>
            <CheckBox Content="Printable" Margin="1"
                      IsChecked="{Binding Path=State, Converter={StaticResource StateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Printable}}">
            </CheckBox>
            <CheckBox Content="Locked" Margin="1"
                      IsChecked="{Binding Path=State, Converter={StaticResource StateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Locked}}">
            </CheckBox>
            <CheckBox Content="Connector" Margin="1"
                      IsChecked="{Binding Path=State, Converter={StaticResource StateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Connector}}">
            </CheckBox>
            <CheckBox Content="None" Margin="1"
                      IsChecked="{Binding Path=State, Converter={StaticResource StateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.None}}">
            </CheckBox>
            <CheckBox Content="Standalone" Margin="1"
                      IsChecked="{Binding Path=State, Converter={StaticResource StateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Standalone}}">
            </CheckBox>
            <CheckBox Content="Input" Margin="1"
                      IsChecked="{Binding Path=State, Converter={StaticResource StateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Input}}">
            </CheckBox>
            <CheckBox Content="Output" Margin="1"
                      IsChecked="{Binding Path=State, Converter={StaticResource StateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Output}}">
            </CheckBox>
        </StackPanel>
    </ControlTemplate>
    <ControlTemplate x:Key="TextControlTemplateKey">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="60"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <TextBlock 
                Text="Text" 
                Style="{StaticResource TextBlockLeftStyleKey}"
                Grid.Row="0" 
                Grid.Column="0">
            </TextBlock>
            <ComboBox 
                IsEditable="True" 
                Text="{Binding Text, UpdateSourceTrigger=PropertyChanged}"
                Style="{StaticResource ComboBoxStyleKey}"
                Grid.Row="0" 
                Grid.Column="1" 
                VerticalAlignment="Center">
                <ComboBoxItem>{0}</ComboBoxItem>
                <ComboBoxItem>{0} {1}</ComboBoxItem>
                <ComboBoxItem>{0} {1} {2}</ComboBoxItem>
            </ComboBox>
        </Grid>
    </ControlTemplate>
    <!-- style -->
    <ControlTemplate x:Key="FontStyleControlTemplateKey">
        <StackPanel Margin="5,2,5,2">
            <CheckBox Content="Regular" Margin="1"
                      IsChecked="{Binding Path=FontStyle, Converter={StaticResource FontStyleFlagsEnumConverter}, ConverterParameter={x:Static core:FontStyle.Regular}}">
            </CheckBox>
            <CheckBox Content="Bold" Margin="1"
                      IsChecked="{Binding Path=FontStyle, Converter={StaticResource FontStyleFlagsEnumConverter}, ConverterParameter={x:Static core:FontStyle.Bold}}">
            </CheckBox>
            <CheckBox Content="Italic" Margin="1"
                      IsChecked="{Binding Path=FontStyle, Converter={StaticResource FontStyleFlagsEnumConverter}, ConverterParameter={x:Static core:FontStyle.Italic}}">
            </CheckBox>
            <CheckBox Content="Underline" Margin="1"
                      IsChecked="{Binding Path=FontStyle, Converter={StaticResource FontStyleFlagsEnumConverter}, ConverterParameter={x:Static core:FontStyle.Underline}}">
            </CheckBox>
            <CheckBox Content="Strikeout" Margin="1"
                      IsChecked="{Binding Path=FontStyle, Converter={StaticResource FontStyleFlagsEnumConverter}, ConverterParameter={x:Static core:FontStyle.Strikeout}}">
            </CheckBox>
        </StackPanel>
    </ControlTemplate>
    <ControlTemplate x:Key="MaxLengthControlTemplateKey">
        <StackPanel Margin="5,2,5,2">
            <CheckBox Content="Disabled" Margin="1"
                      IsChecked="{Binding Path=MaxLengthFlags, Converter={StaticResource MagLengthFlagsEnumConverter}, ConverterParameter={x:Static core:MaxLengthFlags.Disabled}}">
            </CheckBox>
            <CheckBox Content="Start" Margin="1"
                      IsChecked="{Binding Path=MaxLengthFlags, Converter={StaticResource MagLengthFlagsEnumConverter}, ConverterParameter={x:Static core:MaxLengthFlags.Start}}">
            </CheckBox>
            <CheckBox Content="End" Margin="1"
                      IsChecked="{Binding Path=MaxLengthFlags, Converter={StaticResource MagLengthFlagsEnumConverter}, ConverterParameter={x:Static core:MaxLengthFlags.End}}">
            </CheckBox>
            <CheckBox Content="Vertical" Margin="1"
                      IsChecked="{Binding Path=MaxLengthFlags, Converter={StaticResource MagLengthFlagsEnumConverter}, ConverterParameter={x:Static core:MaxLengthFlags.Vertical}}">
            </CheckBox>
            <CheckBox Content="Horizontal" Margin="1"
                      IsChecked="{Binding Path=MaxLengthFlags, Converter={StaticResource MagLengthFlagsEnumConverter}, ConverterParameter={x:Static core:MaxLengthFlags.Horizontal}}">
            </CheckBox>
            <CheckBox Content="All" Margin="1"
                      IsChecked="{Binding Path=MaxLengthFlags, Converter={StaticResource MagLengthFlagsEnumConverter}, ConverterParameter={x:Static core:MaxLengthFlags.All}}">
            </CheckBox>
        </StackPanel>
    </ControlTemplate>
    <ControlTemplate x:Key="StartStateControlTemplateKey">
        <StackPanel Margin="5,2,5,2">
            <CheckBox Content="Default" Margin="1"
                      IsChecked="{Binding Path=MaxLengthStartState, Converter={StaticResource StartStateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Default}}">
            </CheckBox>
            <CheckBox Content="Visible" Margin="1"
                      IsChecked="{Binding Path=MaxLengthStartState, Converter={StaticResource StartStateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Visible}}">
            </CheckBox>
            <CheckBox Content="Printable" Margin="1"
                      IsChecked="{Binding Path=MaxLengthStartState, Converter={StaticResource StartStateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Printable}}">
            </CheckBox>
            <CheckBox Content="Locked" Margin="1"
                      IsChecked="{Binding Path=MaxLengthStartState, Converter={StaticResource StartStateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Locked}}">
            </CheckBox>
            <CheckBox Content="Connector" Margin="1"
                      IsChecked="{Binding Path=MaxLengthStartState, Converter={StaticResource StartStateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Connector}}">
            </CheckBox>
            <CheckBox Content="None" Margin="1"
                      IsChecked="{Binding Path=MaxLengthStartState, Converter={StaticResource StartStateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.None}}">
            </CheckBox>
            <CheckBox Content="Standalone" Margin="1"
                      IsChecked="{Binding Path=MaxLengthStartState, Converter={StaticResource StartStateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Standalone}}">
            </CheckBox>
            <CheckBox Content="Input" Margin="1"
                      IsChecked="{Binding Path=MaxLengthStartState, Converter={StaticResource StartStateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Input}}">
            </CheckBox>
            <CheckBox Content="Output" Margin="1"
                      IsChecked="{Binding Path=MaxLengthStartState, Converter={StaticResource StartStateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Output}}">
            </CheckBox>
        </StackPanel>
    </ControlTemplate>
    <ControlTemplate x:Key="EndStateControlTemplateKey">
        <StackPanel Margin="5,2,5,2">
            <CheckBox Content="Default" Margin="1"
                      IsChecked="{Binding Path=MaxLengthEndState, Converter={StaticResource EndStateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Default}}">
            </CheckBox>
            <CheckBox Content="Visible" Margin="1"
                      IsChecked="{Binding Path=MaxLengthEndState, Converter={StaticResource EndStateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Visible}}">
            </CheckBox>
            <CheckBox Content="Printable" Margin="1"
                      IsChecked="{Binding Path=MaxLengthEndState, Converter={StaticResource EndStateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Printable}}">
            </CheckBox>
            <CheckBox Content="Locked" Margin="1"
                      IsChecked="{Binding Path=MaxLengthEndState, Converter={StaticResource EndStateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Locked}}">
            </CheckBox>
            <CheckBox Content="Connector" Margin="1"
                      IsChecked="{Binding Path=MaxLengthEndState, Converter={StaticResource EndStateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Connector}}">
            </CheckBox>
            <CheckBox Content="None" Margin="1"
                      IsChecked="{Binding Path=MaxLengthEndState, Converter={StaticResource EndStateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.None}}">
            </CheckBox>
            <CheckBox Content="Standalone" Margin="1"
                      IsChecked="{Binding Path=MaxLengthEndState, Converter={StaticResource EndStateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Standalone}}">
            </CheckBox>
            <CheckBox Content="Input" Margin="1"
                      IsChecked="{Binding Path=MaxLengthEndState, Converter={StaticResource EndStateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Input}}">
            </CheckBox>
            <CheckBox Content="Output" Margin="1"
                      IsChecked="{Binding Path=MaxLengthEndState, Converter={StaticResource EndStateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Output}}">
            </CheckBox>
        </StackPanel>
    </ControlTemplate>
    <DataTemplate DataType="{x:Type core:ArgbColor}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="20"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="40"/>
            </Grid.ColumnDefinitions>
            <Rectangle 
                Fill="{StaticResource CheckerBoard}"
                Grid.Row="0" 
                Grid.Column="0" 
                Grid.ColumnSpan="3" 
                Margin="5,2,5,2"
                Height="20">
            </Rectangle>
            <Rectangle 
                Grid.Row="0" 
                Grid.Column="0" 
                Grid.ColumnSpan="3" 
                Margin="5,2,5,2"
                Height="20">
                <Rectangle.Fill>
                    <MultiBinding Converter="{StaticResource ArgbColorToBrushMultiConverter}">
                        <Binding Path="DataContext.A" RelativeSource="{RelativeSource Self}"/>
                        <Binding Path="DataContext.R" RelativeSource="{RelativeSource Self}"/>
                        <Binding Path="DataContext.G" RelativeSource="{RelativeSource Self}"/>
                        <Binding Path="DataContext.B" RelativeSource="{RelativeSource Self}"/>
                    </MultiBinding>
                </Rectangle.Fill>
            </Rectangle>
            <TextBlock 
                Text="A" 
                Style="{StaticResource TextBlockCenterStyleKey}"
                Grid.Row="1"
                Grid.Column="0">
            </TextBlock>
            <TextBlock 
                Text="R" 
                Style="{StaticResource TextBlockCenterStyleKey}"
                Grid.Row="2" 
                Grid.Column="0">
            </TextBlock>
            <TextBlock 
                Text="G" 
                Style="{StaticResource TextBlockCenterStyleKey}"
                Grid.Row="3" 
                Grid.Column="0">
            </TextBlock>
            <TextBlock 
                Text="B" 
                Style="{StaticResource TextBlockCenterStyleKey}"
                Grid.Row="4" 
                Grid.Column="0">
            </TextBlock>
            <Slider 
                Value="{Binding A}" 
                Style="{StaticResource SliderStyleKey}"
                Minimum="0" 
                Maximum="255" 
                TickFrequency="1" 
                IsSnapToTickEnabled="True" 
                Grid.Row="1" 
                Grid.Column="1">
            </Slider>
            <Slider 
                Value="{Binding R}" 
                Style="{StaticResource SliderStyleKey}"
                Minimum="0" 
                Maximum="255" 
                TickFrequency="1" 
                IsSnapToTickEnabled="True" 
                Grid.Row="2" 
                Grid.Column="1">
            </Slider>
            <Slider 
                Value="{Binding G}"
                Style="{StaticResource SliderStyleKey}"
                Minimum="0" 
                Maximum="255" 
                TickFrequency="1" 
                IsSnapToTickEnabled="True" 
                Grid.Row="3" 
                Grid.Column="1">
            </Slider>
            <Slider 
                Value="{Binding B}" 
                Style="{StaticResource SliderStyleKey}"
                Minimum="0" 
                Maximum="255" 
                TickFrequency="1" 
                IsSnapToTickEnabled="True" 
                Grid.Row="4" 
                Grid.Column="1">
            </Slider>
            <TextBox 
                Text="{Binding A, UpdateSourceTrigger=PropertyChanged}" 
                Style="{StaticResource TextBoxCenterStyleKey}"
                Grid.Row="1" 
                Grid.Column="2">
            </TextBox>
            <TextBox 
                Text="{Binding R, UpdateSourceTrigger=PropertyChanged}" 
                Style="{StaticResource TextBoxCenterStyleKey}"
                Grid.Row="2" 
                Grid.Column="2">
            </TextBox>
            <TextBox 
                Text="{Binding G, UpdateSourceTrigger=PropertyChanged}" 
                Style="{StaticResource TextBoxCenterStyleKey}"
                Grid.Row="3" 
                Grid.Column="2">
            </TextBox>
            <TextBox 
                Text="{Binding B, UpdateSourceTrigger=PropertyChanged}" 
                Style="{StaticResource TextBoxCenterStyleKey}"
                Grid.Row="4" 
                Grid.Column="2">
            </TextBox>
        </Grid>
    </DataTemplate>
    <ControlTemplate x:Key="BaseStyleControlTemplateKey">
        <StackPanel>
            <Control Template="{StaticResource NameControlTemplateKey}"/>
            <Expander Header="Stroke" IsExpanded="False">
                <ContentControl Content="{Binding Stroke}"/>
            </Expander>
            <Expander Header="Fill" IsExpanded="False">
                <ContentControl Content="{Binding Fill}"/>
            </Expander>
            <Expander Header="Thickness" IsExpanded="False">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="40"/>
                    </Grid.ColumnDefinitions>
                    <Slider 
                        Value="{Binding Thickness}" 
                        Style="{StaticResource SliderStyleKey}"
                        Minimum="0" 
                        Maximum="50" 
                        TickFrequency="0.1" 
                        SmallChange="0.1" 
                        LargeChange="1" 
                        IsSnapToTickEnabled="True" 
                        Grid.Row="0" 
                        Grid.Column="0">
                    </Slider>
                    <TextBox 
                        Text="{Binding Thickness, UpdateSourceTrigger=PropertyChanged}" 
                        Style="{StaticResource TextBoxCenterStyleKey}"
                        Grid.Row="0" 
                        Grid.Column="1">
                    </TextBox>
                </Grid>
            </Expander>
            <Expander Header="Cap" IsExpanded="False">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="90"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="40"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock 
                        Text="Line Cap" 
                        Style="{StaticResource TextBlockLeftStyleKey}"
                        Grid.Row="0"
                        Grid.Column="0" >
                    </TextBlock>
                    <ComboBox 
                        ItemsSource="{Binding Source={StaticResource ResourceKey=LineCapValues}}" 
                        SelectedItem="{Binding LineCap}" 
                        Style="{StaticResource ComboBoxStyleKey}"
                        Grid.Row="0" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2">
                    </ComboBox>
                </Grid>
            </Expander>
            <Expander Header="Dash" IsExpanded="False">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="90"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="40"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock 
                        Text="Dashes" 
                        Style="{StaticResource TextBlockLeftStyleKey}"
                        Grid.Row="0" 
                        Grid.Column="0">
                    </TextBlock>
                    <TextBlock 
                        Text="Dash Offset" 
                        Style="{StaticResource TextBlockLeftStyleKey}"
                        Grid.Row="1" 
                        Grid.Column="0">
                    </TextBlock>
                    <TextBox 
                        Text="{Binding Dashes, Converter={StaticResource DoubleToStringConverter}}" 
                        Style="{StaticResource TextBoxLeftStyleKey}"
                        Grid.Row="0" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2">
                    </TextBox>
                    <Slider 
                        Value="{Binding DashOffset}" 
                        Style="{StaticResource SliderStyleKey}"
                        Minimum="0" 
                        Maximum="15" 
                        TickFrequency="0.1" 
                        SmallChange="0.1"
                        LargeChange="1"
                        IsSnapToTickEnabled="True" 
                        Grid.Row="1" 
                        Grid.Column="1">
                    </Slider>
                    <TextBox 
                        Text="{Binding DashOffset, UpdateSourceTrigger=PropertyChanged}" 
                        Style="{StaticResource TextBoxCenterStyleKey}"
                        Grid.Row="1" 
                        Grid.Column="2">
                    </TextBox>
                </Grid>
            </Expander>
        </StackPanel>
    </ControlTemplate>
    <DataTemplate DataType="{x:Type core:ArrowStyle}">
        <TabControl>
            <TabItem Header="Arrow">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="90"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="40"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock 
                        Text="Arrow Type" 
                        Style="{StaticResource TextBlockLeftStyleKey}"
                        Grid.Row="0"
                        Grid.Column="0">
                    </TextBlock>
                    <TextBlock 
                        Text="IsStroked" 
                        Style="{StaticResource TextBlockLeftStyleKey}"
                        Grid.Row="1"
                        Grid.Column="0">
                    </TextBlock>
                    <TextBlock 
                        Text="IsFilled" 
                        Style="{StaticResource TextBlockLeftStyleKey}"
                        Grid.Row="2"
                        Grid.Column="0">
                    </TextBlock>
                    <TextBlock 
                        Text="RadiusX" 
                        Style="{StaticResource TextBlockLeftStyleKey}"
                        Grid.Row="3" 
                        Grid.Column="0">
                    </TextBlock>
                    <TextBlock 
                        Text="RadiusY" 
                        Style="{StaticResource TextBlockLeftStyleKey}"
                        Grid.Row="4" 
                        Grid.Column="0">
                    </TextBlock>
                    <ComboBox 
                        ItemsSource="{Binding Source={StaticResource ResourceKey=ArrowTypeValues}}" 
                        SelectedItem="{Binding ArrowType}" 
                        Style="{StaticResource ComboBoxStyleKey}"
                        Grid.Row="0" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2">
                    </ComboBox>
                    <CheckBox 
                        Content=""
                        IsChecked="{Binding IsStroked}"
                        Style="{StaticResource CheckBoxStyleKey}"
                        Grid.Row="1" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2">
                    </CheckBox>
                    <CheckBox
                        Content=""
                        IsChecked="{Binding IsFilled}"
                        Style="{StaticResource CheckBoxStyleKey}"
                        Grid.Row="2" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2">
                    </CheckBox>
                    <Slider 
                        Value="{Binding RadiusX}"
                        Style="{StaticResource SliderStyleKey}"
                        Minimum="0" 
                        Maximum="15" 
                        TickFrequency="0.1" 
                        SmallChange="0.1"
                        LargeChange="1"
                        IsSnapToTickEnabled="True" 
                        Grid.Row="3" 
                        Grid.Column="1">
                    </Slider>
                    <Slider 
                        Value="{Binding RadiusY}" 
                        Style="{StaticResource SliderStyleKey}"
                        Minimum="0" 
                        Maximum="15" 
                        TickFrequency="0.1" 
                        SmallChange="0.1"
                        LargeChange="1"
                        IsSnapToTickEnabled="True" 
                        Grid.Row="4" 
                        Grid.Column="1">
                    </Slider>
                    <TextBox 
                        Text="{Binding RadiusX, UpdateSourceTrigger=PropertyChanged}" 
                        Style="{StaticResource TextBoxCenterStyleKey}"
                        Grid.Row="3" 
                        Grid.Column="2">
                    </TextBox>
                    <TextBox
                        Text="{Binding RadiusY, UpdateSourceTrigger=PropertyChanged}" 
                        Style="{StaticResource TextBoxCenterStyleKey}"
                        Grid.Row="4" 
                        Grid.Column="2">
                    </TextBox>
                </Grid>
            </TabItem>
            <TabItem Header="Style">
                <Control Template="{StaticResource BaseStyleControlTemplateKey}"/>
            </TabItem>
        </TabControl>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:TextStyle}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="90"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="40"/>
            </Grid.ColumnDefinitions>
            <TextBlock 
                Text="FontName" 
                Style="{StaticResource TextBlockLeftStyleKey}"
                Grid.Row="0"
                Grid.Column="0">
            </TextBlock>
            <TextBlock 
                Text="FontFile" 
                Style="{StaticResource TextBlockLeftStyleKey}"
                Grid.Row="1"
                Grid.Column="0">
            </TextBlock>
            <TextBlock 
                Text="FontSize" 
                Style="{StaticResource TextBlockLeftStyleKey}"
                Grid.Row="2" 
                Grid.Column="0">
            </TextBlock>
            <TextBlock 
                Text="FontStyle" 
                Style="{StaticResource TextBlockLeftStyleKey}"
                Grid.Row="3" 
                Grid.Column="0">
            </TextBlock>
            <TextBlock 
                Text="HAlignment" 
                Style="{StaticResource TextBlockLeftStyleKey}"
                Grid.Row="4" 
                Grid.Column="0">
            </TextBlock>
            <TextBlock 
                Text="VAlignment" 
                Style="{StaticResource TextBlockLeftStyleKey}"
                Grid.Row="5" 
                Grid.Column="0">
            </TextBlock>
            <Slider 
                Value="{Binding FontSize}" 
                Style="{StaticResource SliderStyleKey}"
                Minimum="0" 
                Maximum="72" 
                TickFrequency="1" 
                IsSnapToTickEnabled="True" 
                Grid.Row="2" 
                Grid.Column="1">
            </Slider>
            <TextBox 
                Text="{Binding FontName, UpdateSourceTrigger=PropertyChanged}" 
                Style="{StaticResource TextBoxLeftStyleKey}"
                Grid.Row="0" 
                Grid.Column="1" 
                Grid.ColumnSpan="2">
            </TextBox>
            <TextBox 
                Text="{Binding FontFile, UpdateSourceTrigger=PropertyChanged}" 
                Style="{StaticResource TextBoxLeftStyleKey}"
                Grid.Row="1" 
                Grid.Column="1" 
                Grid.ColumnSpan="2">
            </TextBox>
            <TextBox 
                Text="{Binding FontSize, UpdateSourceTrigger=PropertyChanged}" 
                Style="{StaticResource TextBoxCenterStyleKey}"
                Grid.Row="2" 
                Grid.Column="2">
            </TextBox>
            <Control 
                Template="{StaticResource FontStyleControlTemplateKey}"
                Grid.Row="3" 
                Grid.Column="1"
                Grid.ColumnSpan="2">
            </Control>
            <ComboBox 
                ItemsSource="{Binding Source={StaticResource ResourceKey=TextHAlignmentValues}}" 
                SelectedItem="{Binding TextHAlignment}"
                Style="{StaticResource ComboBoxStyleKey}"
                Grid.Row="4" 
                Grid.Column="1" 
                Grid.ColumnSpan="2">
            </ComboBox>
            <ComboBox 
                ItemsSource="{Binding Source={StaticResource ResourceKey=TextVAlignmentValues}}" 
                SelectedItem="{Binding TextVAlignment}" 
                Style="{StaticResource ComboBoxStyleKey}"
                Grid.Row="5" 
                Grid.Column="1" 
                Grid.ColumnSpan="2">
            </ComboBox>
        </Grid>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:LineStyle}">
        <TabControl>
            <TabItem Header="Flags">
                <Control Template="{StaticResource MaxLengthControlTemplateKey}"/>
            </TabItem>
            <TabItem Header="Length">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="40"/>
                    </Grid.ColumnDefinitions>
                    <Slider
                        Value="{Binding MaxLength}" 
                        Style="{StaticResource SliderStyleKey}"
                        Minimum="0" 
                        Maximum="30" 
                        TickFrequency="0.1" 
                        SmallChange="0.1"
                        LargeChange="1"
                        IsSnapToTickEnabled="True" 
                        Grid.Column="0">
                    </Slider>
                    <TextBox
                        Text="{Binding MaxLength, UpdateSourceTrigger=PropertyChanged}" 
                        Style="{StaticResource TextBoxCenterStyleKey}"
                        Grid.Column="1" >
                    </TextBox>
                </Grid>
            </TabItem>
            <TabItem Header="Start">
                <Control Template="{StaticResource StartStateControlTemplateKey}"/>
            </TabItem>
            <TabItem Header="End">
                <Control Template="{StaticResource EndStateControlTemplateKey}"/>
            </TabItem>
        </TabControl>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:ShapeStyle}">
        <TabControl>
            <TabItem Header="Base">
                <Control Template="{StaticResource BaseStyleControlTemplateKey}"/>
            </TabItem>
            <TabItem Header="Text">
                <ContentControl Content="{Binding TextStyle}"/>
            </TabItem>
            <TabItem Header="Line">
                <StackPanel>
                    <Expander Header="Line Start Arrow" 
                              IsExpanded="False">
                        <ContentControl Content="{Binding StartArrowStyle}"/>
                    </Expander>
                    <Expander Header="Line End Arrow" 
                              IsExpanded="False">
                        <ContentControl Content="{Binding EndArrowStyle}"/>
                    </Expander>
                    <Expander Header="Line MaxLength" 
                              IsExpanded="False">
                        <ContentControl Content="{Binding LineStyle}"/>
                    </Expander>
                </StackPanel>
            </TabItem>
        </TabControl>
    </DataTemplate>
    <!-- data -->
    <ControlTemplate x:Key="BindingsMenu">
        <Menu Background="Transparent" HorizontalAlignment="Right">
            <MenuItem
                Command="{Binding DataContext.Commands.AddBindingCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}" 
                CommandParameter="{Binding}" 
                Header="+">
            </MenuItem>
        </Menu>
    </ControlTemplate>
    <ControlTemplate x:Key="BindingsControlTemplateKey">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="40*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="60*"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Control Template="{StaticResource BindingsMenu}" Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="3" Margin="2,0,2,0"/>
            <GridSplitter 
                Grid.Column="1" 
                Grid.Row="1"
                Grid.RowSpan="2"
                Width="10" 
                Background="Transparent" 
                ResizeBehavior="PreviousAndNext" 
                ShowsPreview="True">
            </GridSplitter>
            <TextBlock 
                Grid.Column="0" 
                Grid.Row="1" 
                Margin="5,2,0,2" 
                VerticalAlignment="Center" 
                Text="Property">
                <TextBlock.Style>
                    <Style TargetType="TextBlock">
                        <Setter Property="Visibility" Value="Visible"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding Bindings.Length, FallbackValue=0}" Value="0">
                                <Setter Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </TextBlock.Style>
            </TextBlock>
            <TextBlock 
                Grid.Column="2" 
                Grid.Row="1" 
                Margin="0,2,5,2" 
                VerticalAlignment="Center" 
                Text="Path">
                <TextBlock.Style>
                    <Style TargetType="TextBlock">
                        <Setter Property="Visibility" Value="Visible"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding Bindings.Length, FallbackValue=0}" Value="0">
                                <Setter Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </TextBlock.Style>
            </TextBlock>
            <ItemsControl 
                VerticalContentAlignment="Stretch" 
                VerticalAlignment="Stretch" 
                Grid.Column="0"
                Grid.Row="2"
                ItemsSource="{Binding Bindings, UpdateSourceTrigger=PropertyChanged}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Grid Height="Auto" VerticalAlignment="Top">
                            <TextBox 
                                Margin="5,2,0,2" 
                                VerticalAlignment="Center" 
                                Text="{Binding Path=Property, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                            </TextBox>
                        </Grid>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
            <ItemsControl 
                x:Name="bindingsItemsControls"
                VerticalContentAlignment="Stretch" 
                VerticalAlignment="Stretch" 
                Grid.Column="2" 
                Grid.Row="2"
                ItemsSource="{Binding Bindings, UpdateSourceTrigger=PropertyChanged}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Grid Height="Auto" VerticalAlignment="Top">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="30"/>
                            </Grid.ColumnDefinitions>
                            <TextBox 
                                Grid.Column="0" 
                                Margin="0,2,5,2" 
                                VerticalAlignment="Center" 
                                Text="{Binding Path=Path, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                            </TextBox>
                            <Button 
                                Grid.Column="1" 
                                Margin="5,0,5,0" 
                                VerticalAlignment="Center" 
                                Content="-" 
                                Command="{Binding DataContext.Commands.RemoveBindingCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}">
                                <Button.CommandParameter>
                                    <MultiBinding Converter="{StaticResource ShapeBindingParameterConverter}">
                                        <Binding Path="DataContext" ElementName="bindingsItemsControls"/>
                                        <Binding Path="DataContext" RelativeSource="{RelativeSource Self}"/>
                                    </MultiBinding>
                                </Button.CommandParameter>
                            </Button>
                        </Grid>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </Grid>
    </ControlTemplate>
    <ControlTemplate x:Key="PropertiesMenu">
        <Menu Background="Transparent" HorizontalAlignment="Right">
            <MenuItem 
                Command="{Binding DataContext.Commands.AddPropertyCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}" 
                CommandParameter="{Binding}" 
                Header="+">
            </MenuItem>
        </Menu>
    </ControlTemplate>
    <ControlTemplate x:Key="PropertiesControlTemplateKey">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="40*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="60*"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Control 
                Template="{StaticResource PropertiesMenu}" 
                Grid.Row="0" 
                Grid.Column="0" 
                Grid.ColumnSpan="3" 
                Margin="2,0,2,0">
            </Control>
            <GridSplitter 
                Grid.Column="1" 
                Grid.Row="1"
                Grid.RowSpan="2"
                Width="10" 
                Background="Transparent" 
                ResizeBehavior="PreviousAndNext" 
                ShowsPreview="True">
            </GridSplitter>
            <TextBlock 
                Grid.Column="0" 
                Grid.Row="1" 
                Margin="5,2,0,2" 
                VerticalAlignment="Center" 
                Text="Name">
                <TextBlock.Style>
                    <Style TargetType="TextBlock">
                        <Setter Property="Visibility" Value="Visible"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding Properties.Length, FallbackValue=0}" Value="0">
                                <Setter Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </TextBlock.Style>
            </TextBlock>
            <TextBlock 
                Grid.Column="2" 
                Grid.Row="1" 
                Margin="0,2,5,2" 
                VerticalAlignment="Center"
                Text="Value">
                <TextBlock.Style>
                    <Style TargetType="TextBlock">
                        <Setter Property="Visibility" Value="Visible"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding Properties.Length, FallbackValue=0}" Value="0">
                                <Setter Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </TextBlock.Style>
            </TextBlock>
            <ItemsControl 
                VerticalContentAlignment="Stretch" 
                VerticalAlignment="Stretch" 
                Grid.Column="0" 
                Grid.Row="2"
                ItemsSource="{Binding Properties, UpdateSourceTrigger=PropertyChanged}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Grid Height="Auto" VerticalAlignment="Top">
                            <TextBox 
                                Margin="5,2,0,2" 
                                VerticalAlignment="Center" 
                                Text="{Binding Path=Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                            </TextBox>
                        </Grid>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
            <ItemsControl 
                x:Name="propertiesItemsControls"
                VerticalContentAlignment="Stretch" 
                VerticalAlignment="Stretch" 
                Grid.Column="2" 
                Grid.Row="2"
                ItemsSource="{Binding Properties, UpdateSourceTrigger=PropertyChanged}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Grid Height="Auto" VerticalAlignment="Top">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="30"/>
                            </Grid.ColumnDefinitions>
                            <TextBox 
                                Grid.Column="0" 
                                Margin="0,2,5,2" 
                                VerticalAlignment="Center" 
                                Text="{Binding Path=Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                            </TextBox>
                            <Button 
                                Grid.Column="1" 
                                Margin="5,0,5,0" 
                                VerticalAlignment="Center" 
                                Content="-" 
                                Command="{Binding DataContext.Commands.RemovePropertyCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}">
                                <Button.CommandParameter>
                                    <MultiBinding Converter="{StaticResource ShapePropertyParameterConverter}">
                                        <Binding Path="DataContext" ElementName="propertiesItemsControls"/>
                                        <Binding Path="DataContext" RelativeSource="{RelativeSource Self}"/>
                                    </MultiBinding>
                                </Button.CommandParameter>
                            </Button>
                        </Grid>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </Grid>
    </ControlTemplate>
    <ControlTemplate x:Key="ShapesPropertiesControlTemplateKey">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="50*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="50*"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <GridSplitter 
                Grid.Column="1" 
                Grid.Row="0"
                Grid.RowSpan="2"
                Width="10" 
                Background="Transparent" 
                ResizeBehavior="PreviousAndNext" 
                ShowsPreview="True">
            </GridSplitter>
            <TextBlock 
                Grid.Column="0"
                Grid.Row="0" 
                Margin="5,2,0,2" 
                VerticalAlignment="Center" 
                Text="Name">
                <TextBlock.Style>
                    <Style TargetType="TextBlock">
                        <Setter Property="Visibility" Value="Visible"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding ShapesProperties.Length, FallbackValue=0}" Value="0">
                                <Setter Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </TextBlock.Style>
            </TextBlock>
            <TextBlock 
                Grid.Column="2" 
                Grid.Row="0" 
                Margin="0,2,5,2" 
                VerticalAlignment="Center" 
                Text="Value">
                <TextBlock.Style>
                    <Style TargetType="TextBlock">
                        <Setter Property="Visibility" Value="Visible"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding ShapesProperties.Length, FallbackValue=0}" Value="0">
                                <Setter Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </TextBlock.Style>
            </TextBlock>
            <ItemsControl 
                VerticalContentAlignment="Stretch" 
                VerticalAlignment="Stretch" 
                Grid.Column="0" 
                Grid.Row="1"
                ItemsSource="{Binding ShapesProperties, UpdateSourceTrigger=PropertyChanged}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Grid Height="Auto" VerticalAlignment="Top">
                            <TextBox
                                Margin="5,2,0,2" VerticalAlignment="Center" 
                                Text="{Binding Path=Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                            </TextBox>
                        </Grid>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
            <ItemsControl 
                VerticalContentAlignment="Stretch" 
                VerticalAlignment="Stretch" 
                Grid.Column="2" 
                Grid.Row="1"
                ItemsSource="{Binding ShapesProperties, UpdateSourceTrigger=PropertyChanged}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Grid Height="Auto" VerticalAlignment="Top">
                            <TextBox 
                                Margin="0,2,5,2" 
                                VerticalAlignment="Center" 
                                Text="{Binding Path=Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                            </TextBox>
                        </Grid>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </Grid>
    </ControlTemplate>
    <ControlTemplate x:Key="RecordMenu">
        <Menu Background="Transparent" HorizontalAlignment="Right">
            <MenuItem 
                Command="{Binding DataContext.Commands.ResetRecordCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}" 
                CommandParameter="{Binding}" 
                Header="X">
            </MenuItem>
        </Menu>
    </ControlTemplate>
    <DataTemplate DataType="{x:Type core:Record}">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="40*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="60*"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <GridSplitter 
                Grid.Column="1" 
                Grid.Row="0"
                Grid.RowSpan="2"
                Width="10" 
                Background="Transparent" 
                ResizeBehavior="PreviousAndNext" 
                ShowsPreview="True">
            </GridSplitter>
            <TextBlock 
                Grid.Column="0" 
                Grid.Row="0" 
                Margin="5,2,0,2" 
                VerticalAlignment="Center" 
                Text="Name">
                <TextBlock.Style>
                    <Style TargetType="TextBlock">
                        <Setter Property="Visibility" Value="Visible"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding}" Value="{x:Null}">
                                <Setter Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </TextBlock.Style>
            </TextBlock>
            <TextBlock 
                Grid.Column="2" 
                Grid.Row="0" 
                Margin="0,2,5,2" 
                VerticalAlignment="Center" 
                Text="Value">
                <TextBlock.Style>
                    <Style TargetType="TextBlock">
                        <Setter Property="Visibility" Value="Visible"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding}" Value="{x:Null}">
                                <Setter Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </TextBlock.Style>
            </TextBlock>
            <ItemsControl 
                VerticalContentAlignment="Stretch" 
                VerticalAlignment="Stretch" 
                Grid.Row="1" 
                Grid.Column="0"
                ItemsSource="{Binding Columns, UpdateSourceTrigger=PropertyChanged}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Grid Height="Auto" VerticalAlignment="Top">
                            <TextBox 
                                Margin="5,2,0,2" VerticalAlignment="Center" 
                                Text="{Binding Path=Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                            </TextBox>
                        </Grid>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
            <ItemsControl 
                VerticalContentAlignment="Stretch" 
                VerticalAlignment="Stretch" 
                Grid.Row="1" 
                Grid.Column="2"
                ItemsSource="{Binding Values, UpdateSourceTrigger=PropertyChanged}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Grid Height="Auto" VerticalAlignment="Top">
                            <TextBox 
                                Margin="0,2,5,2" 
                                VerticalAlignment="Center" 
                                Text="{Binding Path=Content, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                            </TextBox>
                        </Grid>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </Grid>
    </DataTemplate>
    <ControlTemplate x:Key="RecordControlTemplateKey">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Control Template="{StaticResource RecordMenu}" Grid.Row="0" Margin="2,0,2,0"/>
            <ContentControl Content="{Binding Record}" Grid.Row="1"/>
        </Grid>
    </ControlTemplate>
    <ControlTemplate x:Key="ColumnsMenu">
        <Menu Background="Transparent" HorizontalAlignment="Right">
            <MenuItem 
                Command="{Binding DataContext.Commands.AddColumnCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}" 
                CommandParameter="{Binding}" 
                Header="+">
            </MenuItem>
        </Menu>
    </ControlTemplate>
    <ControlTemplate x:Key="ColumnsControlTemplateKey">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Control Template="{StaticResource ColumnsMenu}" Grid.Row="0" Margin="2,0,2,0"/>
            <Grid Height="Auto" VerticalAlignment="Top" Grid.Row="1">
                <Grid.Style>
                    <Style TargetType="Grid">
                        <Setter Property="Visibility" Value="Visible"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding Columns.Length, FallbackValue=0}" Value="0">
                                <Setter Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Grid.Style>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="30"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition/>
                    <RowDefinition/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <TextBlock 
                    Grid.Column="0" 
                    Grid.Row="0"
                    Margin="5,2,5,2" 
                    VerticalAlignment="Center" 
                    Text="Name">
                </TextBlock>
            </Grid>
            <ItemsControl 
                x:Name="columnsItemsControls"
                VerticalContentAlignment="Stretch" 
                VerticalAlignment="Stretch" 
                Grid.Row="2"
                ItemsSource="{Binding Columns, UpdateSourceTrigger=PropertyChanged}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Grid Height="Auto" VerticalAlignment="Top">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="30"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition/>
                                <RowDefinition/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <TextBox 
                                Grid.Column="0" 
                                Grid.Row="0"
                                Margin="5,2,5,2" 
                                VerticalAlignment="Center" 
                                Text="{Binding Path=Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                            </TextBox>
                            <Button 
                                Grid.Column="1" 
                                Grid.Row="0" 
                                Margin="5,2,5,2" 
                                VerticalAlignment="Center" 
                                Content="-" 
                                Command="{Binding DataContext.Commands.RemoveColumnCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}">
                                <Button.CommandParameter>
                                    <MultiBinding Converter="{StaticResource ColumnParameterConverter}">
                                        <Binding Path="DataContext" ElementName="columnsItemsControls"/>
                                        <Binding Path="DataContext" RelativeSource="{RelativeSource Self}"/>
                                    </MultiBinding>
                                </Button.CommandParameter>
                            </Button>
                        </Grid>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </Grid>
    </ControlTemplate>
    <ControlTemplate x:Key="DatabaseControlTemplateKey">
        <StackPanel>
            <Control Template="{StaticResource NameControlTemplateKey}"/>
            <Expander
                Header="Columns" 
                IsExpanded="True">
                <Control Template="{StaticResource ColumnsControlTemplateKey}"/>
            </Expander>
            <Expander 
                Header="Current Record" 
                IsExpanded="True">
                <ContentControl Content="{Binding CurrentRecord}"/>
            </Expander>
        </StackPanel>
    </ControlTemplate>
    <ControlTemplate x:Key="DataControlTemplate">
        <TabControl>
            <TabItem Header="Record">
                <Control Template="{StaticResource RecordControlTemplateKey}"/>
            </TabItem>
            <TabItem Header="Bindings">
                <Control Template="{StaticResource BindingsControlTemplateKey}"/>
            </TabItem>
            <TabItem Header="Properties">
                <Control Template="{StaticResource PropertiesControlTemplateKey}"/>
            </TabItem>
        </TabControl>
    </ControlTemplate>
    <!-- shapes -->
    <DataTemplate DataType="{x:Type core:XPoint}">
        <TabControl>
            <TabItem Header="Point">
                <StackPanel>
                    <Control Template="{StaticResource NameControlTemplateKey}"/>
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="60"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock 
                            Text="X" 
                            Style="{StaticResource TextBlockLeftStyleKey}"
                            Grid.Row="0" 
                            Grid.Column="0">
                        </TextBlock>
                        <TextBox 
                            Text="{Binding X, UpdateSourceTrigger=PropertyChanged}" 
                            Style="{StaticResource TextBoxLeftStyleKey}"
                            Grid.Row="0" 
                            Grid.Column="1">
                        </TextBox>
                    </Grid>
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="60"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock 
                            Text="Y" 
                            Style="{StaticResource TextBlockLeftStyleKey}"
                            Grid.Row="0" 
                            Grid.Column="0">
                        </TextBlock>
                        <TextBox 
                            Text="{Binding Y, UpdateSourceTrigger=PropertyChanged}" 
                            Style="{StaticResource TextBoxLeftStyleKey}"
                            Grid.Row="0" 
                            Grid.Column="1">
                        </TextBox>
                    </Grid>
                    <Expander Header="State">
                        <Control Template="{StaticResource StateControlTemplateKey}"/>
                    </Expander>
                    <Expander Header="Data">
                        <Control Template="{StaticResource DataControlTemplate}"/>
                    </Expander>
                </StackPanel>
            </TabItem>
            <TabItem Header="Shape">
                <ContentControl Content="{Binding Shape}"/>
            </TabItem>
        </TabControl>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XLine}">
        <StackPanel>
            <Control Template="{StaticResource NameControlTemplateKey}"/>
            <Control Template="{StaticResource StyleControlTemplateKey}"/>
            <Control Template="{StaticResource IsStrokedControlTemplateKey}"/>
            <Expander Header="Start">
                <ContentControl Content="{Binding Start}"/>
            </Expander>
            <Expander Header="End">
                <ContentControl Content="{Binding End}"/>
            </Expander>
            <Expander Header="State">
                <Control Template="{StaticResource StateControlTemplateKey}"/>
            </Expander>
            <Expander Header="Data">
                <Control Template="{StaticResource DataControlTemplate}"/>
            </Expander>
            <Expander Header="Style">
                <ContentControl Content="{Binding Style}"/>
            </Expander>
        </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XRectangle}">
        <StackPanel>
            <Control Template="{StaticResource NameControlTemplateKey}"/>
            <Control Template="{StaticResource StyleControlTemplateKey}"/>
            <Control Template="{StaticResource IsStrokedControlTemplateKey}"/>
            <Control Template="{StaticResource IsFilledControlTemplateKey}"/>
            <Control Template="{StaticResource TextControlTemplateKey}"/>
            <Expander Header="TopLeft">
                <ContentControl Content="{Binding TopLeft}"/>
            </Expander>
            <Expander Header="BottomRight">
                <ContentControl Content="{Binding BottomRight}"/>
            </Expander>
            <Expander Header="Grid">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="70"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="40"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock 
                        Text="IsGrid" 
                        Style="{StaticResource TextBlockLeftStyleKey}"
                        Grid.Row="0"
                        Grid.Column="0">
                    </TextBlock>
                    <TextBlock 
                        Text="OffsetX" 
                        Style="{StaticResource TextBlockLeftStyleKey}"
                        Grid.Row="1" 
                        Grid.Column="0">
                    </TextBlock>
                    <TextBlock 
                        Text="OffsetY" 
                        Style="{StaticResource TextBlockLeftStyleKey}"
                        Grid.Row="2" 
                        Grid.Column="0">
                    </TextBlock>
                    <TextBlock 
                        Text="CellWidth" 
                        Style="{StaticResource TextBlockLeftStyleKey}"
                        Grid.Row="3" 
                        Grid.Column="0">
                    </TextBlock>
                    <TextBlock 
                        Text="CellHeight" 
                        Style="{StaticResource TextBlockLeftStyleKey}"
                        Grid.Row="4" 
                        Grid.Column="0">
                    </TextBlock>
                    <CheckBox 
                        Content=""
                        IsChecked="{Binding IsGrid}"
                        Style="{StaticResource CheckBoxStyleKey}"
                        Grid.Row="0" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2">
                    </CheckBox>
                    <Slider 
                        Value="{Binding OffsetX}"
                        Style="{StaticResource SliderStyleKey}"
                        Minimum="0" 
                        Maximum="60" 
                        TickFrequency="0.1" 
                        SmallChange="0.1"
                        LargeChange="1"
                        IsSnapToTickEnabled="True" 
                        Grid.Row="1" 
                        Grid.Column="1">
                    </Slider>
                    <Slider 
                        Value="{Binding OffsetY}" 
                        Style="{StaticResource SliderStyleKey}"
                        Minimum="0" 
                        Maximum="60" 
                        TickFrequency="0.1" 
                        SmallChange="0.1"
                        LargeChange="1"
                        IsSnapToTickEnabled="True" 
                        Grid.Row="2" 
                        Grid.Column="1">
                    </Slider>
                    <Slider 
                        Value="{Binding CellWidth}"
                        Style="{StaticResource SliderStyleKey}"
                        Minimum="0" 
                        Maximum="60" 
                        TickFrequency="0.1" 
                        SmallChange="0.1"
                        LargeChange="1"
                        IsSnapToTickEnabled="True" 
                        Grid.Row="3" 
                        Grid.Column="1">
                    </Slider>
                    <Slider 
                        Value="{Binding CellHeight}" 
                        Style="{StaticResource SliderStyleKey}"
                        Minimum="0" 
                        Maximum="60" 
                        TickFrequency="0.1" 
                        SmallChange="0.1"
                        LargeChange="1"
                        IsSnapToTickEnabled="True" 
                        Grid.Row="4" 
                        Grid.Column="1">
                    </Slider>
                    <TextBox 
                        Text="{Binding OffsetX, UpdateSourceTrigger=PropertyChanged}" 
                        Style="{StaticResource TextBoxCenterStyleKey}"
                        Grid.Row="1" 
                        Grid.Column="2">
                    </TextBox>
                    <TextBox
                        Text="{Binding OffsetY, UpdateSourceTrigger=PropertyChanged}" 
                        Style="{StaticResource TextBoxCenterStyleKey}"
                        Grid.Row="2" 
                        Grid.Column="2">
                    </TextBox>
                    <TextBox 
                        Text="{Binding CellWidth, UpdateSourceTrigger=PropertyChanged}" 
                        Style="{StaticResource TextBoxCenterStyleKey}"
                        Grid.Row="3" 
                        Grid.Column="2">
                    </TextBox>
                    <TextBox
                        Text="{Binding CellHeight, UpdateSourceTrigger=PropertyChanged}" 
                        Style="{StaticResource TextBoxCenterStyleKey}"
                        Grid.Row="4" 
                        Grid.Column="2">
                    </TextBox>
                </Grid>
            </Expander>
            <Expander Header="State">
                <Control Template="{StaticResource StateControlTemplateKey}"/>
            </Expander>
            <Expander Header="Data">
                <Control Template="{StaticResource DataControlTemplate}"/>
            </Expander>
            <Expander Header="Style">
                <ContentControl Content="{Binding Style}"/>
            </Expander>
        </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XEllipse}">
        <StackPanel>
            <Control Template="{StaticResource NameControlTemplateKey}"/>
            <Control Template="{StaticResource StyleControlTemplateKey}"/>
            <Control Template="{StaticResource IsStrokedControlTemplateKey}"/>
            <Control Template="{StaticResource IsFilledControlTemplateKey}"/>
            <Control Template="{StaticResource TextControlTemplateKey}"/>
            <Expander Header="TopLeft">
                <ContentControl Content="{Binding TopLeft}"/>
            </Expander>
            <Expander Header="BottomRight">
                <ContentControl Content="{Binding BottomRight}"/>
            </Expander>
            <Expander Header="State">
                <Control Template="{StaticResource StateControlTemplateKey}"/>
            </Expander>
            <Expander Header="Data">
                <Control Template="{StaticResource DataControlTemplate}"/>
            </Expander>
            <Expander Header="Style">
                <ContentControl Content="{Binding Style}"/>
            </Expander>
        </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XArc}">
        <StackPanel>
            <Control Template="{StaticResource NameControlTemplateKey}"/>
            <Control Template="{StaticResource StyleControlTemplateKey}"/>
            <Control Template="{StaticResource IsStrokedControlTemplateKey}"/>
            <Control Template="{StaticResource IsFilledControlTemplateKey}"/>
            <Expander Header="Point1">
                <ContentControl Content="{Binding Point1}"/>
            </Expander>
            <Expander Header="Point2">
                <ContentControl Content="{Binding Point2}"/>
            </Expander>
            <Expander Header="Point3">
                <ContentControl Content="{Binding Point3}"/>
            </Expander>
            <Expander Header="Point4">
                <ContentControl Content="{Binding Point4}"/>
            </Expander>
            <Expander Header="State">
                <Control Template="{StaticResource StateControlTemplateKey}"/>
            </Expander>
            <Expander Header="Data">
                <Control Template="{StaticResource DataControlTemplate}"/>
            </Expander>
            <Expander Header="Style">
                <ContentControl Content="{Binding Style}"/>
            </Expander>
        </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XBezier}">
        <StackPanel>
            <Control Template="{StaticResource NameControlTemplateKey}"/>
            <Control Template="{StaticResource StyleControlTemplateKey}"/>
            <Control Template="{StaticResource IsStrokedControlTemplateKey}"/>
            <Control Template="{StaticResource IsFilledControlTemplateKey}"/>
            <Expander Header="Point1">
                <ContentControl Content="{Binding Point1}"/>
            </Expander>
            <Expander Header="Point2">
                <ContentControl Content="{Binding Point2}"/>
            </Expander>
            <Expander Header="Point3">
                <ContentControl Content="{Binding Point3}"/>
            </Expander>
            <Expander Header="Point4">
                <ContentControl Content="{Binding Point4}"/>
            </Expander>
            <Expander Header="State">
                <Control Template="{StaticResource StateControlTemplateKey}"/>
            </Expander>
            <Expander Header="Data">
                <Control Template="{StaticResource DataControlTemplate}"/>
            </Expander>
            <Expander Header="Style">
                <ContentControl Content="{Binding Style}"/>
            </Expander>
        </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XQBezier}">
        <StackPanel>
            <Control Template="{StaticResource NameControlTemplateKey}"/>
            <Control Template="{StaticResource StyleControlTemplateKey}"/>
            <Control Template="{StaticResource IsStrokedControlTemplateKey}"/>
            <Control Template="{StaticResource IsFilledControlTemplateKey}"/>
            <Expander Header="Point1">
                <ContentControl Content="{Binding Point1}"/>
            </Expander>
            <Expander Header="Point2">
                <ContentControl Content="{Binding Point2}"/>
            </Expander>
            <Expander Header="Point3">
                <ContentControl Content="{Binding Point3}"/>
            </Expander>
            <Expander Header="State">
                <Control Template="{StaticResource StateControlTemplateKey}"/>
            </Expander>
            <Expander Header="Data">
                <Control Template="{StaticResource DataControlTemplate}"/>
            </Expander>
            <Expander Header="Style">
                <ContentControl Content="{Binding Style}"/>
            </Expander>
        </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XText}">
        <StackPanel>
            <Control Template="{StaticResource NameControlTemplateKey}"/>
            <Control Template="{StaticResource StyleControlTemplateKey}"/>
            <Control Template="{StaticResource TextControlTemplateKey}"/>
            <Expander Header="TopLeft">
                <ContentControl Content="{Binding TopLeft}"/>
            </Expander>
            <Expander Header="BottomRight">
                <ContentControl Content="{Binding BottomRight}"/>
            </Expander>
            <Expander Header="State">
                <Control Template="{StaticResource StateControlTemplateKey}"/>
            </Expander>
            <Expander Header="Data">
                <Control Template="{StaticResource DataControlTemplate}"/>
            </Expander>
            <Expander Header="Style">
                <ContentControl Content="{Binding Style}"/>
            </Expander>
        </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XImage}">
        <StackPanel>
            <Control Template="{StaticResource NameControlTemplateKey}"/>
            <Control Template="{StaticResource StyleControlTemplateKey}"/>
            <Control Template="{StaticResource IsStrokedControlTemplateKey}"/>
            <Control Template="{StaticResource IsFilledControlTemplateKey}"/>
            <Control Template="{StaticResource TextControlTemplateKey}"/>
            <Expander Header="Path">
                <Grid>
                    <TextBox 
                        Text="{Binding Path, UpdateSourceTrigger=PropertyChanged}" 
                        Style="{StaticResource TextBoxLeftStyleKey}">
                    </TextBox>
                </Grid>
            </Expander>
            <Expander Header="TopLeft">
                <ContentControl Content="{Binding TopLeft}"/>
            </Expander>
            <Expander Header="BottomRight">
                <ContentControl Content="{Binding BottomRight}"/>
            </Expander>
            <Expander Header="State">
                <Control Template="{StaticResource StateControlTemplateKey}"/>
            </Expander>
            <Expander Header="Data">
                <Control Template="{StaticResource DataControlTemplate}"/>
            </Expander>
            <Expander Header="Style">
                <ContentControl Content="{Binding Style}"/>
            </Expander>
        </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XGroup}">
        <TabControl>
            <TabItem Header="Group">
                <StackPanel>
                    <Control Template="{StaticResource NameControlTemplateKey}"/>
                    <Expander Header="Properties" 
                              IsExpanded="True">
                        <Control Template="{StaticResource ShapesPropertiesControlTemplateKey}"/>
                    </Expander>
                    <Expander Header="State">
                        <Control Template="{StaticResource StateControlTemplateKey}"/>
                    </Expander>
                    <Expander Header="Data">
                        <Control Template="{StaticResource DataControlTemplate}"/>
                    </Expander>
                </StackPanel>
            </TabItem>
            <TabItem Header="Shapes">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <controls:GroupShapesDragAndDropListBox 
                        x:Name="shapesListBox"
                        Tag="{Binding DataContext.Editor, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}"
                        ItemsSource="{Binding Shapes}"
                        BorderBrush="{x:Null}"
                        Grid.Row="0">
                        <controls:GroupShapesDragAndDropListBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding}" Margin="0,5,0,5"/>
                            </DataTemplate>
                        </controls:GroupShapesDragAndDropListBox.ItemTemplate>
                    </controls:GroupShapesDragAndDropListBox>
                    <ContentControl 
                        Content="{Binding ElementName=shapesListBox, Path=SelectedItem}" 
                        Grid.Row="1" 
                        Margin="5,2,5,2">
                    </ContentControl>
                </Grid>
            </TabItem>
            <TabItem Header="Connectors">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <controls:GroupConnectorsDragAndDropListBox 
                        x:Name="connectorsListBox"
                        Tag="{Binding DataContext.Editor, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}"
                        ItemsSource="{Binding Connectors}"
                        BorderBrush="{x:Null}"
                        Grid.Row="0">
                        <controls:GroupConnectorsDragAndDropListBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding}" Margin="0,5,0,5"/>
                            </DataTemplate>
                        </controls:GroupConnectorsDragAndDropListBox.ItemTemplate>
                    </controls:GroupConnectorsDragAndDropListBox>
                    <ContentControl 
                        Content="{Binding ElementName=connectorsListBox, Path=SelectedItem}" 
                        Grid.Row="1" 
                        Margin="5,2,5,2">
                    </ContentControl>
                </Grid>
            </TabItem>
        </TabControl>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XPath}">
        <StackPanel>
            <Control Template="{StaticResource NameControlTemplateKey}"/>
            <Control Template="{StaticResource StyleControlTemplateKey}"/>
            <Control Template="{StaticResource IsStrokedControlTemplateKey}"/>
            <Control Template="{StaticResource IsFilledControlTemplateKey}"/>
            <Expander Header="Geometry">
                <ContentControl Content="{Binding Geometry}"/>
            </Expander>
            <Expander Header="State">
                <Control Template="{StaticResource StateControlTemplateKey}"/>
            </Expander>
            <Expander Header="Data">
                <Control Template="{StaticResource DataControlTemplate}"/>
            </Expander>
            <Expander Header="Style">
                <ContentControl Content="{Binding Style}"/>
            </Expander>
        </StackPanel>
    </DataTemplate>
    <!-- project -->
    <ContextMenu x:Key="ContainerContextMenu" DataContext="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource Self}}">
        <MenuItem 
            Header="Te_mplate" 
            Tag="{Binding Path=DataContext, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}"
            DataContext="{Binding Path=DataContext, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}" ItemsSource="{Binding Editor.Project.Templates}">
            <MenuItem.ItemContainerStyle>
                <Style TargetType="MenuItem">
                    <Setter Property="Header" Value="{Binding Name}"/>
                    <Setter Property="Command" Value="{Binding Path=Tag.Commands.ApplyTemplateCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type MenuItem}}, FallbackValue={x:Null}}"/>
                    <Setter Property="CommandParameter" Value="{Binding}"/>
                    <Setter Property="IsCheckable" Value="True"/>
                    <Setter Property="IsChecked" Value="False"/>
                    <Style.Triggers>
                        <DataTrigger Value="True">
                            <DataTrigger.Binding>
                                <MultiBinding Converter="{StaticResource ObjectEqualityConverter}">
                                    <Binding Path="Tag.Editor.Project.CurrentContainer.Template" RelativeSource="{RelativeSource FindAncestor, AncestorType={x:Type MenuItem}}"/>
                                    <Binding Path="DataContext" RelativeSource="{RelativeSource Self}"/>
                                </MultiBinding>
                            </DataTrigger.Binding>
                            <Setter Property="IsChecked" Value="True"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </MenuItem.ItemContainerStyle>
        </MenuItem>
        <Separator/>
        <MenuItem 
            Header="Insert Container Bef_ore" 
            InputGestureText="" 
            Command="{Binding DataContext.Commands.InsertContainerBeforeCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}" 
            CommandParameter="{Binding}">
        </MenuItem>
        <MenuItem 
            Header="Insert Container Aft_er" 
            InputGestureText="" 
            Command="{Binding DataContext.Commands.InsertContainerAfterCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}" 
            CommandParameter="{Binding}">
        </MenuItem>
        <Separator/>
        <MenuItem 
            Header="Cu_t" 
            InputGestureText="Ctrl+X" 
            Command="{Binding DataContext.Commands.CutCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}" 
            CommandParameter="{Binding}">
        </MenuItem>
        <MenuItem 
            Header="_Copy" 
            InputGestureText="Ctrl+C" 
            Command="{Binding DataContext.Commands.CopyCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}"
            CommandParameter="{Binding}">
        </MenuItem>
        <MenuItem 
            Header="_Paste" 
            InputGestureText="Ctrl+V" 
            Command="{Binding DataContext.Commands.PasteCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}" 
            CommandParameter="{Binding}">
        </MenuItem>
        <Separator/>
        <MenuItem 
            Header="_Delete" 
            InputGestureText="Del" 
            Command="{Binding DataContext.Commands.DeleteCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}" 
            CommandParameter="{Binding}">
        </MenuItem>
        <Separator/>
        <MenuItem 
            Header="E_xport" 
            InputGestureText="Ctrl+E" 
            Command="{Binding DataContext.Commands.ExportCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}" 
            CommandParameter="{Binding}">
        </MenuItem>
    </ContextMenu>
    <ContextMenu x:Key="DocumentContextMenu" DataContext="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource Self}}">
        <MenuItem 
            Header="_Add Container" 
            InputGestureText="Ctrl+N" 
            Command="{Binding DataContext.Commands.AddContainerCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}" 
            CommandParameter="{Binding}">
        </MenuItem>
        <Separator/>
        <MenuItem 
            Header="Insert Document Bef_ore" 
            InputGestureText="" 
            Command="{Binding DataContext.Commands.InsertDocumentBeforeCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}" 
            CommandParameter="{Binding}">
        </MenuItem>
        <MenuItem 
            Header="Insert Document Aft_er" 
            InputGestureText="" 
            Command="{Binding DataContext.Commands.InsertDocumentAfterCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}" 
            CommandParameter="{Binding}">
        </MenuItem>
        <Separator/>
        <MenuItem 
            Header="Cu_t" 
            InputGestureText="Ctrl+X" 
            Command="{Binding DataContext.Commands.CutCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}" 
            CommandParameter="{Binding}">
        </MenuItem>
        <MenuItem 
            Header="_Copy" 
            InputGestureText="Ctrl+C"
            Command="{Binding DataContext.Commands.CopyCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}" 
            CommandParameter="{Binding}">
        </MenuItem>
        <MenuItem 
            Header="_Paste" 
            InputGestureText="Ctrl+V" 
            Command="{Binding DataContext.Commands.PasteCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}" 
            CommandParameter="{Binding}">
        </MenuItem>
        <Separator/>
        <MenuItem 
            Header="_Delete" 
            InputGestureText="Del" 
            Command="{Binding DataContext.Commands.DeleteCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}" 
            CommandParameter="{Binding}">
        </MenuItem>
        <Separator/>
        <MenuItem 
            Header="E_xport" 
            InputGestureText="Ctrl+E" 
            Command="{Binding DataContext.Commands.ExportCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}" 
            CommandParameter="{Binding}">
        </MenuItem>
    </ContextMenu>
    <ContextMenu x:Key="PojectContextMenu" DataContext="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource Self}}">
        <MenuItem 
            Header="_Add Document" 
            InputGestureText="Ctrl+N" 
            Command="{Binding DataContext.Commands.AddDocumentCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}" 
            CommandParameter="{Binding}">
        </MenuItem>
        <Separator/>
        <MenuItem 
            Header="E_xport" 
            InputGestureText="Ctrl+E" 
            Command="{Binding DataContext.Commands.ExportCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}" 
            CommandParameter="{Binding}">
        </MenuItem>
    </ContextMenu>
    <DataTemplate DataType="{x:Type core:Options}">
        <TabControl>
            <TabItem Header="{x:Static p:Resources.OptionsHeaderGeneral}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="100"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="40"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock 
                        Text="{x:Static p:Resources.OptionsSnapToGrid}" 
                        Style="{StaticResource TextBlockLeftStyleKey}"
                        Grid.Row="0"
                        Grid.Column="0">
                    </TextBlock>
                    <TextBlock 
                        Text="{x:Static p:Resources.OptionsSnapX}" 
                        Style="{StaticResource TextBlockLeftStyleKey}"
                        Grid.Row="1" 
                        Grid.Column="0">
                    </TextBlock>
                    <TextBlock 
                        Text="{x:Static p:Resources.OptionsSnapY}" 
                        Style="{StaticResource TextBlockLeftStyleKey}"
                        Grid.Row="2" 
                        Grid.Column="0">
                    </TextBlock>
                    <TextBlock 
                        Text="{x:Static p:Resources.OptionsHitTreshold}" 
                        Style="{StaticResource TextBlockLeftStyleKey}"
                        Grid.Row="3" 
                        Grid.Column="0">
                    </TextBlock>
                    <TextBlock 
                        Text="{x:Static p:Resources.OptionsMoveMode}" 
                        Style="{StaticResource TextBlockLeftStyleKey}"
                        Grid.Row="4"
                        Grid.Column="0">
                    </TextBlock>
                    <TextBlock 
                        Text="{x:Static p:Resources.OptionsTryToConnect}" 
                        Style="{StaticResource TextBlockLeftStyleKey}"
                        Grid.Row="5"
                        Grid.Column="0">
                    </TextBlock>
                    <CheckBox 
                        Content=""
                        IsChecked="{Binding SnapToGrid}"
                        Style="{StaticResource CheckBoxStyleKey}"
                        Grid.Row="0" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2">
                    </CheckBox>
                    <TextBox 
                        Text="{Binding SnapX, UpdateSourceTrigger=PropertyChanged}" 
                        Style="{StaticResource TextBoxLeftStyleKey}"
                        Grid.Row="1" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2">
                    </TextBox>
                    <TextBox 
                        Text="{Binding SnapY, UpdateSourceTrigger=PropertyChanged}" 
                        Style="{StaticResource TextBoxLeftStyleKey}"
                        Grid.Row="2" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2">
                    </TextBox>
                    <TextBox 
                        Text="{Binding HitTreshold, UpdateSourceTrigger=PropertyChanged}" 
                        Style="{StaticResource TextBoxLeftStyleKey}"
                        Grid.Row="3" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2">
                    </TextBox>
                    <ComboBox 
                        ItemsSource="{Binding Source={StaticResource ResourceKey=MoveModeValues}}" 
                        SelectedItem="{Binding MoveMode}" 
                        Style="{StaticResource ComboBoxStyleKey}" 
                        Grid.Row="4" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2">
                    </ComboBox>
                    <CheckBox 
                        Content=""
                        IsChecked="{Binding TryToConnect}"
                        Style="{StaticResource CheckBoxStyleKey}"
                        Grid.Row="5" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2">
                    </CheckBox>
                </Grid>
            </TabItem>
            <TabItem Header="{x:Static p:Resources.OptionsHeaderDefaults}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="100"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="40"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock 
                        Text="{x:Static p:Resources.OptionsDefaultIsStroked}" 
                        Style="{StaticResource TextBlockLeftStyleKey}"
                        Grid.Row="0"
                        Grid.Column="0">
                    </TextBlock>
                    <TextBlock 
                        Text="{x:Static p:Resources.OptionsDefaultIsFilled}" 
                        Style="{StaticResource TextBlockLeftStyleKey}"
                        Grid.Row="1"
                        Grid.Column="0">
                    </TextBlock>
                    <TextBlock 
                        Text="{x:Static p:Resources.OptionsDefaultIsClosed}" 
                        Style="{StaticResource TextBlockLeftStyleKey}"
                        Grid.Row="2"
                        Grid.Column="0">
                    </TextBlock>
                    <TextBlock 
                        Text="{x:Static p:Resources.OptionsDefaultIsSmoothJoin}" 
                        Style="{StaticResource TextBlockLeftStyleKey}"
                        Grid.Row="3"
                        Grid.Column="0">
                    </TextBlock>
                    <TextBlock 
                        Text="{x:Static p:Resources.OptionsDefaultFillRule}" 
                        Style="{StaticResource TextBlockLeftStyleKey}" 
                        Grid.Row="4"
                        Grid.Column="0">
                    </TextBlock>
                    <CheckBox 
                        Content=""
                        IsChecked="{Binding DefaultIsStroked}"
                        Style="{StaticResource CheckBoxStyleKey}"
                        Grid.Row="0" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2">
                    </CheckBox>
                    <CheckBox 
                        Content=""
                        IsChecked="{Binding DefaultIsFilled}"
                        Style="{StaticResource CheckBoxStyleKey}"
                        Grid.Row="1" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2">
                    </CheckBox>
                    <CheckBox 
                        Content=""
                        IsChecked="{Binding DefaultIsClosed}"
                        Style="{StaticResource CheckBoxStyleKey}"
                        Grid.Row="2" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2">
                    </CheckBox>
                    <CheckBox 
                        Content=""
                        IsChecked="{Binding DefaultIsSmoothJoin}"
                        Style="{StaticResource CheckBoxStyleKey}"
                        Grid.Row="3" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2">
                    </CheckBox>
                    <ComboBox 
                        ItemsSource="{Binding Source={StaticResource ResourceKey=XFillRuleValues}}" 
                        SelectedItem="{Binding DefaultFillRule}" 
                        Style="{StaticResource ComboBoxStyleKey}"
                        Grid.Row="4" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2">
                    </ComboBox>
                </Grid>
            </TabItem>
            <TabItem Header="{x:Static p:Resources.OptionsHeaderAdvanced}">
                <StackPanel>
                    <Expander Header="{x:Static p:Resources.OptionsPointShape}">
                        <ContentControl Content="{Binding PointShape}"/>
                    </Expander>
                    <Expander Header="{x:Static p:Resources.OptionsPointStyle}">
                        <ContentControl Content="{Binding PointStyle}"/>
                    </Expander>
                    <Expander Header="{x:Static p:Resources.OptionsSelectionStyle}">
                        <ContentControl Content="{Binding SelectionStyle}"/>
                    </Expander>
                    <Expander Header="{x:Static p:Resources.OptionsHelperStyle}">
                        <ContentControl Content="{Binding HelperStyle}"/>
                    </Expander>
                </StackPanel>
            </TabItem>
        </TabControl>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:Project}">
        <StackPanel>
            <Expander Header="{x:Static p:Resources.ProjectOptions}" 
                      IsExpanded="False">
                <ContentControl Content="{Binding Options}"/>
            </Expander>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="40"/>
                </Grid.ColumnDefinitions>
                <TextBox 
                    Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" 
                    Style="{StaticResource TextBoxLeftStyleKey}"
                    Grid.Row="0" 
                    Grid.Column="0" 
                    Grid.ColumnSpan="2">
                </TextBox>
            </Grid>
        </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:Document}">
        <StackPanel>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="60"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <TextBlock 
                    Text="{x:Static p:Resources.DocumentName}" 
                    Style="{StaticResource TextBlockLeftStyleKey}"
                    Grid.Row="0" 
                    Grid.Column="0">
                </TextBlock>
                <TextBox 
                    Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" 
                    Style="{StaticResource TextBoxLeftStyleKey}"
                    Grid.Row="0" 
                    Grid.Column="1">
                </TextBox>
            </Grid>
        </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:Container}">
        <StackPanel>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="60"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <TextBlock 
                    Text="{x:Static p:Resources.ContainerName}" 
                    Style="{StaticResource TextBlockLeftStyleKey}"
                    Grid.Row="0" 
                    Grid.Column="0">
                </TextBlock>
                <TextBox 
                    Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" 
                    BorderBrush="{x:Null}" 
                    Style="{StaticResource TextBoxLeftStyleKey}"
                    Grid.Row="0" 
                    Grid.Column="1">
                </TextBox>
            </Grid>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="60"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <TextBlock 
                    Text="{x:Static p:Resources.ContainerWidth}" 
                    Style="{StaticResource TextBlockLeftStyleKey}" 
                    Grid.Row="0" 
                    Grid.Column="0">
                </TextBlock>
                <TextBlock 
                    Text="{x:Static p:Resources.ContainerHeight}" 
                    Style="{StaticResource TextBlockLeftStyleKey}"
                    Grid.Row="1" 
                    Grid.Column="0">
                </TextBlock>
                <TextBox 
                    Text="{Binding Width, UpdateSourceTrigger=PropertyChanged}" 
                    Style="{StaticResource TextBoxLeftStyleKey}"
                    Grid.Row="0" 
                    Grid.Column="1">
                </TextBox>
                <TextBox 
                    Text="{Binding Height, UpdateSourceTrigger=PropertyChanged}" 
                    Style="{StaticResource TextBoxLeftStyleKey}"
                    Grid.Row="1" 
                    Grid.Column="1">
                </TextBox>
            </Grid>
            <Expander Header="{x:Static p:Resources.ContainerBackground}">
                <ContentControl Content="{Binding Background}"/>
            </Expander>
            <Expander Header="{x:Static p:Resources.ContainerTemplate}">
                <StackPanel>
                    <ComboBox 
                        ItemsSource="{Binding Path=DataContext.Editor.Project.Templates, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}" 
                        SelectedItem="{Binding Path=DataContext.Template, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type StackPanel}}}" 
                        Style="{StaticResource ComboBoxStyleKey}">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}"/>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                    <ContentControl Content="{Binding Template}"/>
                </StackPanel>
            </Expander>
            <Expander Header="{x:Static p:Resources.ContainerProperties}" 
                      IsExpanded="True">
                <Control Template="{StaticResource PropertiesControlTemplateKey}"/>
            </Expander>
        </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:StyleLibrary}">
        <TextBox 
            Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" 
            BorderBrush="{x:Null}" 
            TextAlignment="Left" 
            VerticalAlignment="Center">
        </TextBox>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:GroupLibrary}">
        <TextBox 
            Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" 
            BorderBrush="{x:Null}" 
            TextAlignment="Left" 
            VerticalAlignment="Center">
        </TextBox>
    </DataTemplate>
    <ControlTemplate x:Key="ContainerControlTemplateKey">
        <ItemsControl ItemsSource="{Binding Layers}">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <Canvas 
                        Width="{Binding Width}" 
                        Height="{Binding Height}" 
                        Background="{Binding Background, Converter={StaticResource ArgbColorToBrushConverter}}">
                    </Canvas>
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <controls:LayerElement/>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
            <ItemsControl.ItemContainerStyle>
                <Style TargetType="ContentPresenter">
                    <Setter Property="Width" Value="{Binding Path=DataContext.Width, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Canvas}}, FallbackValue=0.0}" />
                    <Setter Property="Height" Value="{Binding Path=DataContext.Height, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Canvas}}, FallbackValue=0.0}" />
                </Style>
            </ItemsControl.ItemContainerStyle>
        </ItemsControl>
    </ControlTemplate>
    <ControlTemplate x:Key="ContainerEditorControlTemplateKey">
        <Border Width="{Binding Width}" Height="{Binding Height}">
            <Border.Style>
                <Style TargetType="Border">
                    <Setter Property="BorderBrush" Value="Transparent"/>
                    <Setter Property="BorderThickness" Value="0"/>
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding IsTemplate}" Value="True">
                            <Setter Property="BorderBrush" Value="Red"/>
                            <Setter Property="BorderThickness" Value="2"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </Border.Style>
            <Grid Width="{Binding Width}" Height="{Binding Height}" Background="Transparent">
                <Control DataContext="{Binding Template}" Template="{StaticResource ContainerControlTemplateKey}"/>
                <Control DataContext="{Binding}" Template="{StaticResource ContainerControlTemplateKey}"/>
                <controls:EditorCanvas 
                    Tag="{Binding Path=DataContext, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}"
                    Background="Transparent"
                    Focusable="True"
                    FocusVisualStyle="{x:Null}"
                    Width="{Binding Width}" 
                    Height="{Binding Height}">
                    <controls:LayerElement DataContext="{Binding WorkingLayer}"/>
                    <controls:LayerElement DataContext="{Binding HelperLayer}"/>
                </controls:EditorCanvas>
            </Grid>
        </Border>
    </ControlTemplate>
</ResourceDictionary>
